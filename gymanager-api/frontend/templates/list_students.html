{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center mb-4">
        <div class="col-lg-8">
            <h2 class="display-6 fw-bold text-primary mb-5 text-center">Lista de Alunos</h2>

            <form method="get" class="input-group input-group-lg shadow-sm mb-3 border rounded-pill">
                <input type="search" name="search" class="form-control py-3" placeholder="Buscar aluno por nome ou referência..." aria-label="Buscar" value="{{ request.GET.q|default:'' }}">
                <button class="btn btn-primary fw-semibold rounded-end-pill px-4" type="submit">
                    <i class="bi bi-search text-white"></i>
                </button>
            </form>
            
            {% if pagination.total_pages > 1 %}
            <nav aria-label="Navegação de páginas de alunos" class="mb-4">
                <form method='post' class="d-flex justify-content-center" action="{% url 'list_students' %}">
                    {% csrf_token %}
                    <ul class="pagination pagination-md shadow-sm mb-0">
                        <li class="page-item {% if not pagination.has_previous_page %}disabled{% endif %}">
                            <button type="submit" name="previous" class="page-link rounded-start-pill border-0 py-2 px-3" {% if not pagination.has_previous_page %}disabled{% endif %}>
                                <i class="bi bi-arrow-left me-1"></i>
                            </button>
                        </li>
                        
                        <li class="page-item active" aria-current="page">
                            <span class="page-link border-0 py-2 px-3 bg-primary text-white">
                                Página {{ pagination.current_page }}
                            </span>
                        </li>

                        <li class="page-item">
                            <span class="page-link border-0 py-2 px-3 text-secondary-emphasis bg-light">
                                de {{ pagination.total_pages }}
                            </span>
                        </li>

                        <li class="page-item {% if not pagination.has_next_page %}disabled{% endif %}">
                            <button type="submit" name="next" class="page-link rounded-end-pill border-0 py-2 px-3" {% if not pagination.has_next_page %}disabled{% endif %}>
                                <i class="bi bi-arrow-right ms-1"></i>
                            </button>
                        </li>
                    </ul>
                </form>
            </nav>
            {% endif %}

            {% if pagination.total_items > 0 %}
            <div class="text-center mb-4">
                <span class="badge bg-info-subtle text-info-emphasis fw-semibold p-2 px-3 me-2">
                    <i class="bi bi-grid-fill me-1"></i> Total de Alunos: {{ pagination.total_items }}
                </span>
                <span class="text-muted small">
                    <i class="bi bi-collection-fill me-1"></i> Alunos nesta página: {{ students|length }}
                </span>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="list-group">
                {% for student in students %}
                
                {# Aplica borda vermelha e sombra maior se o pagamento estiver vencido #}
                <a href="{% url 'detail_student' student.id %}" 
                   class="list-group-item list-group-item-action mb-3 rounded-4 p-4 text-decoration-none transition-shadow 
                          {% if student.is_overdue %}border border-danger{% else %}border-0 shadow-sm{% endif %}">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="me-4 text-primary fs-3">
                                <i class="bi bi-person-badge-fill"></i>
                            </div>
                            <div>
                                {# Nome do aluno com o badge de status de pagamento #}
                                <div class="d-flex align-items-center mb-1">
                                    <h5 class="fw-bold text-dark mb-0 me-2">{{ student.name }}</h5>
                                    {% if student.is_overdue %}
                                    <span class="badge bg-danger text-white fw-bold p-2 rounded-pill">
                                        <i class="bi bi-x-circle-fill me-1"></i> VENCIDO
                                    </span>
                                    {% else %}
                                    <span class="badge bg-success text-white fw-bold p-2 rounded-pill">
                                        <i class="bi bi-check-circle-fill me-1"></i> EM DIA
                                    </span>
                                    {% endif %}
                                </div>
                                
                                <p class="mb-1 text-muted small"><i class="bi bi-telephone-fill me-1"></i> {{ student.phone }}</p>
                                <p class="mb-0 text-secondary small"><i class="bi bi-tag-fill me-1"></i> {{ student.reference }}</p>
                            </div>
                        </div>
                        {# Ícone de seta para detalhes #}
                        <span class="text-primary fs-5">
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    </div>
                </a>
                
                {% empty %}
                <div class="text-center text-muted py-5 border rounded-4 bg-light">
                    <i class="bi bi-exclamation-circle me-2 fs-4"></i>
                    <p class="mt-2 mb-0 fw-semibold">Nenhum aluno encontrado.</p>
                    <p class="small">Tente refinar sua busca.</p>
                </div>
                {% endfor %}
            </div>
            
        </div>
    </div>
</div>
{% endblock %}
